<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Camping Game</title>
  <link rel="icon" href="img/fav.svg">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin.css"> <style>
    .admin-main::before {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(14, 23, 32, 0.4); 
        z-index: 0;
    }
    .admin-tab-content, .header-main, .confirm-bar, .admin-main h1 {
        position: relative;
        z-index: 1;
    }
    .admin-table th:nth-child(6) { width: 10%; }
    .admin-table th:nth-child(7) { width: 20%; }
  </style>
</head>
<body>
  <div class="admin-container">
    <aside class="admin-sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <img src="img/fav.svg" alt="Logo">
        <span>Camping Game</span>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item active" data-tab="dashboard">
          <i class="fas fa-chart-line"></i> Dashboard
        </button>
        <button class="nav-item" data-tab="games">
          <i class="fas fa-gamepad"></i> Quản lý Game
        </button>
        <button class="nav-item" data-tab="rooms">
          <i class="fas fa-door-open"></i> Phòng Chơi
        </button>
        <button class="nav-item" data-tab="users">
          <i class="fas fa-users"></i> Người Dùng
        </button>
        <button class="nav-item" data-tab="reports" id="btn-reports">
            <i class="fas fa-flag"></i> Báo Cáo
        </button>
        <button class="nav-item" data-tab="analytics">
          <i class="fas fa-chart-bar"></i> Quản lý Web
        </button>
      </nav>
      <div class="sidebar-footer">
        <a href="/" target="_blank" class="nav-item link-home">
            <i class="fas fa-home"></i> Trang chủ
        </a>
        <button id="logoutBtn" class="nav-item logout">
          <i class="fas fa-sign-out-alt"></i> Đăng xuất
        </button>
      </div>
    </aside>

    <div class="overlay" id="popupOverlay"></div>

    <main class="admin-main">
        
      <button class="icon-btn" id="navToggleBtn" style="position:fixed; top:15px; left:15px; z-index:1100; display:none;">
        <i class="fas fa-bars"></i>
      </button>

      <section id="dashboardTab" class="admin-tab-content active">
        <header class="content-header">
          <h1>Tổng quan</h1>
          <div class="header-actions">
            <button id="refreshDataBtn" class="btn btn-secondary"><i class="fas fa-sync-alt"></i> Làm mới</button>
          </div>
        </header>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon purple"><i class="fas fa-gamepad"></i></div>
            <div class="stat-info">
              <h3>Tổng Game</h3>
              <p id="totalGames">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon blue"><i class="fas fa-door-open"></i></div>
            <div class="stat-info">
              <h3>Phòng Online</h3>
              <p id="totalRooms">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green"><i class="fas fa-user-check"></i></div>
            <div class="stat-info">
              <h3>Người chơi Online</h3>
              <p id="onlineUsers">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange"><i class="fas fa-users"></i></div>
            <div class="stat-info">
              <h3>Tổng User</h3>
              <p id="totalUsers">0</p>
            </div>
          </div>
        </div>

        <div class="table-wrap" style="margin-top: 30px;">
            <h3 style="padding: 16px; color: var(--text-dark); border-bottom: 1px solid var(--border-light);">
                <i class="fas fa-history"></i> Hoạt động Gần đây (Socket Events)
            </h3>
            <ul id="activityLog" style="list-style: none; padding: 10px 16px; max-height: 350px; overflow-y: auto;">
                <li style="padding: 8px 0; border-bottom: 1px dotted var(--border-light);">Đang chờ kết nối Socket...</li>
            </ul>
        </div>
        </section>

      <section id="gamesTab" class="admin-tab-content" style="display:none">
        <header class="content-header">
          <h1>Quản lý Game</h1>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="gamesSearch" placeholder="Tìm game...">
            </div>
            <button id="syncGamesBtn" class="btn btn-secondary"><i class="fas fa-sync"></i> Đồng bộ File</button>
            <button id="addGameBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Thêm Game</button>
          </div>
        </header>
        
        <div class="table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th style="width: 15%;">ID</th>
                <th style="width: 10%;">Ảnh</th>
                <th style="width: 20%;">Tên (VI/EN)</th>
                <th style="width: 10%;">Người chơi</th>
                <th style="width: 10%;">Nổi bật</th>
                <th style="width: 10%;">Trạng thái</th>
                <th style="width: 15%;">Hành động</th>
              </tr>
            </thead>
            <tbody id="adminGamesList">
              </tbody>
          </table>
        </div>
        <div id="gamesPagination" class="pagination-controls"></div>
      </section>

      <section id="roomsTab" class="admin-tab-content" style="display:none">
        <header class="content-header">
          <h1>Quản lý Phòng</h1>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="roomsSearch" placeholder="Tìm mã phòng...">
            </div>
          </div>
        </header>

        <div class="table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Mã Phòng</th>
                <th>Game</th>
                <th>Chủ phòng</th>
                <th>Số người</th>
                <th>Trạng thái</th>
                <th>Tạo lúc</th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody id="adminRoomsList"></tbody>
          </table>
        </div>
        <div id="roomsPagination" class="pagination-controls"></div>
      </section>

      <section id="usersTab" class="admin-tab-content" style="display:none">
        <header class="content-header">
          <h1>Quản lý Người dùng</h1>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="usersSearch" placeholder="Tìm user...">
            </div>
            <button id="addUserBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Thêm Người Dùng</button>
            </div>
        </header>

        <div class="table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Tên hiển thị</th>
                <th>Email</th>
                <th>Loại</th>
                <th style="width: 20%;">Ngày tạo</th>
                <th style="width: 25%;">Lịch sử chơi</th> 
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody id="adminUsersList"></tbody>
          </table>
        </div>
        <div id="usersPagination" class="pagination-controls"></div>
      </section>
      
      <section id="reportsTab" class="admin-tab-content" style="display:none">
        <header class="content-header">
          <h1>Quản lý Báo Cáo</h1>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" id="reportsSearch" placeholder="Tìm báo cáo...">
            </div>
          </div>
        </header>

        <div class="table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID Báo Cáo</th>
                <th>Người Báo Cáo</th>
                <th>Loại Báo Cáo</th>
                <th>Nội Dung</th>
                <th>Trạng Thái</th>
                <th>Ngày Tạo</th>
                <th>Hành Động</th>
              </tr>
            </thead>
            <tbody id="adminReportsList"></tbody>
          </table>
        </div>
        <div id="reportsPagination" class="pagination-controls"></div>
        </section>

        <div id="reportModal" class="popup-modal wide" style="display:none; max-width: 600px;">
            <span class="close-modal" id="closeReportModal">&times;</span>
            <h2>Chi tiết Báo cáo</h2>
            <div id="reportDetailContent" style="margin-top: 20px; line-height: 1.6;">
                <p><strong>ID:</strong> <span id="detailReportId"></span></p>
                <p><strong>Người gửi:</strong> <span id="detailReporter"></span></p>
                <p><strong>Danh mục:</strong> <span id="detailCategory"></span></p>
                <p><strong>Ngày gửi:</strong> <span id="detailDate"></span></p>
                <div style="margin: 15px 0;">
                    <strong>Nội dung chi tiết:</strong>
                    <div id="detailContentText" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px; white-space: pre-wrap; border: 1px solid var(--border-light);"></div>
                </div>
                <form id="reportForm" class="auth-form" style="text-align:left; margin-top: 20px; border-top: 1px solid var(--border-light); padding-top: 20px;">
                    <input type="hidden" id="editReportId">
                    <div class="form-group">
                        <label for="detailStatus">Trạng thái xử lý:</label>
                        <select id="detailStatus" class="form-select" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-light);">
                            <option value="pending">Đang chờ</option>
                            <option value="reviewed">Đang xem xét</option>
                            <option value="resolved">Đã giải quyết</option>
                            <option value="rejected">Từ chối</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="detailAdminNote">Ghi chú của Admin:</label>
                        <textarea id="detailAdminNote" rows="3" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-light);" placeholder="Nhập ghi chú xử lý..."></textarea>
                    </div>
                    <div class="form-actions" style="margin-top:20px; text-align:right;">
                        <button type="button" class="btn btn-cancel close-modal-btn">Đóng</button>
                        <button type="submit" class="btn btn-save">Cập nhật Báo cáo</button>
                    </div>
                </form>
            </div>
        </div>
      <section id="analyticsTab" class="admin-tab-content" style="display:none">
        <header class="content-header">
          <h1>Quản lý Web (Vercel)</h1>
        </header>
        <div class="vercel-links-container">
            <a href="https://vercel.com/kines-projects/datn/analytics" target="_blank" class="vercel-card">
                <i class="fas fa-chart-area"></i>
                <span>Vercel Analytics</span>
            </a>
            <a href="https://vercel.com/kines-projects/datn/speed-insights" target="_blank" class="vercel-card">
                <i class="fas fa-tachometer-alt"></i>
                <span>Speed Insights</span>
            </a>
        </div>
      </section>

    </main>
  </div>

  <div id="gameModal" class="popup-modal wide">
      <span class="close-modal">&times;</span>
      <h2 id="modalTitle">Thêm/Sửa Game</h2>
      <form id="gameForm" class="auth-form">
        <input type="hidden" id="gameIdOriginal"> 
        
        <div class="form-group"> <label>ID Game (Mã thư mục):</label> <input type="text" id="gameIdInput" required> <small style="color:#9aa4b2; font-size:0.85em;">Phải trùng với tên thư mục trong public/game/</small> </div>
        
        <div class="form-grid-2">
          <div> <label>Tên (Việt):</label> <input type="text" id="gameNameVi" required> </div>
          <div> <label>Tên (Anh):</label> <input type="text" id="gameNameEn" required> </div>
        </div>

        <div class="form-grid-2">
            <div> <label>Thể loại (Việt):</label> <input type="text" id="gameCatVi" required> </div>
            <div> <label>Thể loại (Anh):</label> <input type="text" id="gameCatEn" required> </div>
        </div>

        <div class="form-grid-2">
            <div> <label>Mô tả (Việt):</label> <textarea id="gameDescVi" rows="3"></textarea> </div>
            <div> <label>Mô tả (Anh):</label> <textarea id="gameDescEn" rows="3"></textarea> </div>
        </div>

        <div class="form-grid-2" style="align-items: center;">
            <div> <label>Số người chơi (VD: 2-10):</label> <input type="text" id="gamePlayers" required> </div>
            <div class="checkbox-wrapper">
                <label for="gameFeatured" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="gameFeatured" style="width:auto;"> 
                    <span>Đánh dấu Nổi bật?</span>
                </label>
            </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel close-modal-btn">Hủy</button>
          <button type="submit" class="btn btn-save">Lưu</button>
        </div>
      </form>
  </div>
  
  <div id="userModal" class="popup-modal" style="display:none; max-width:450px;">
      <span class="close-modal" id="closeUserModal">&times;</span>
      <h2 id="userModalTitle">Sửa Người Dùng</h2>
      <form id="userForm" class="auth-form" style="text-align:left;">
          <input type="hidden" id="userIdInput">
          <div class="form-group"> <label>Username (Không đổi):</label> <input type="text" id="userUsernameInput" disabled> </div>
          <div class="form-group"> <label>Tên hiển thị:</label> <input type="text" id="userDisplayNameInput" required> </div>
          <div class="form-group"> <label>Email:</label> <input type="email" id="userEmailInput"> </div>
          <div class="form-group"> <label>Lịch sử chơi:</label> <textarea id="userPlayHistory" disabled rows="3" style="font-size:0.85em;"></textarea> </div>
          <div class="form-actions" style="margin-top:20px; text-align:right;">
              <button type="button" class="btn btn-cancel close-modal-btn">Hủy</button>
              <button type="submit" class="btn btn-save">Lưu thay đổi</button>
          </div>
      </form>
  </div>

  <div id="addUserModal" class="popup-modal" style="display:none; max-width:450px;">
    <span class="close-modal" id="closeAddUserModal">&times;</span>
    <h2 id="addUserModalTitle">Thêm Người Dùng Mới</h2>
    <form id="addUserForm" class="auth-form" style="text-align:left;">
        <div class="form-group"> <label>Username:</label> <input type="text" id="addUsernameInput" required> </div>
        
        <div class="form-group"> 
            <label>Password:</label> 
            <div class="password-field">
                <input type="password" id="addPasswordInput" required>
                <button type="button" id="toggleAddPassword" class="toggle-password-btn">
                    <i class="fas fa-eye" style="pointer-events: none;"></i>
                </button>
            </div>
        </div>
        
        <div class="form-group"> <label>Tên hiển thị:</label> <input type="text" id="addDisplayNameInput" required> </div>
        <div class="form-group"> <label>Email (Tùy chọn):</label> <input type="email" id="addEmailInput"> </div>
        
        <div class="form-actions" style="margin-top:20px; text-align:right;">
            <button type="button" class="btn btn-cancel close-modal-btn">Hủy</button>
            <button type="submit" class="btn btn-save">Tạo Người Dùng</button>
        </div>
    </form>
</div>

<div id="reportModal" class="popup-modal wide" style="display:none; max-width: 600px;">
    <span class="close-modal">&times;</span>
    <h2>Chi tiết Báo cáo</h2>
    
    <div class="report-details" style="margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px;">
        <p><strong>ID:</strong> <span id="detailReportId"></span></p>
        <p><strong>Người gửi:</strong> <span id="detailReporter" style="color: var(--accent);"></span></p>
        <p><strong>Danh mục:</strong> <span id="detailCategory"></span></p>
        <p><strong>Ngày gửi:</strong> <span id="detailDate"></span></p>
        
        <div style="margin-top: 10px;">
            <strong>Nội dung:</strong>
            <div id="detailContentText" style="background: var(--bg-dark); padding: 10px; border-radius: 6px; margin-top: 5px; white-space: pre-wrap; border: 1px solid var(--border-dark);"></div>
        </div>
    </div>

    <form id="reportForm" class="auth-form" style="text-align:left;">
        <input type="hidden" id="editReportId">
        
        <div class="form-group">
            <label for="detailStatus">Trạng thái xử lý:</label>
            <select id="detailStatus">
                <option value="pending">Đang chờ</option>
                <option value="reviewed">Đang xem xét</option>
                <option value="resolved">Đã giải quyết</option>
                <option value="rejected">Từ chối</option>
            </select>
        </div>

        <div class="form-group">
            <label for="detailAdminNote">Ghi chú của Admin:</label>
            <textarea id="detailAdminNote" rows="3" placeholder="Nhập ghi chú xử lý..."></textarea>
        </div>

        <div class="form-actions" style="margin-top:20px; text-align:right;">
            <button type="button" class="btn btn-cancel close-modal-btn">Đóng</button>
            <button type="submit" class="btn btn-save">Cập nhật Báo cáo</button>
        </div>
    </form>
</div>
<div id="adminOverlay" class="admin-overlay" style="display:none;">
    <div class="spinner"></div>
  </div>
  <script>
    window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="admin.js"></script>
</body>
</html>