<!doctype html>
<html lang="vi">
<body>
  <div class="card">
    </div>
  <script>
    const BASE_API_URL = 'https://datn-socket.up.railway.app';
    const loginBtn = document.getElementById('login');
    const passInput = document.getElementById('p');
    const userIpnut = document.getElementById('u');
    
    loginBtn.addEventListener('click', handleLogin);
    passInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') handleLogin(); });
    userIpnut.addEventListener('keypress', function(e) { if (e.key === 'Enter') handleLogin(); });

    const toggleBtn = document.getElementById('togglePass');
    const icon = toggleBtn.querySelector('i');
    toggleBtn.addEventListener('click', function() {
        if (passInput.type === 'password') {
            passInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    });

    async function handleLogin() {
      const u = document.getElementById('u').value.trim();
      const p = document.getElementById('p').value;
      const msg = document.getElementById('msg');
      msg.textContent = '';
      
      if (!u || !p) {
          msg.textContent = 'Vui lòng nhập cả username và password.';
          return;
      }

      try {
        const res = await fetch(`${BASE_API_URL}/admin/login`, { 
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: u, password: p }),
          // --- SỬA LỖI: Thêm dòng này để gửi cookie ---
          credentials: 'include'
          // ----------------------------------------
        });
        
        const j = await res.json();
        if (res.ok && j.ok) {
          location.href = '/admin.html'; 
        } else {
          msg.textContent = j.message || 'Login failed';
        }
      } catch (e) {
        msg.textContent = 'Network error';
      }
    };
  </script>
</body>
</html>